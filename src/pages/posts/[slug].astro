---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = (await getCollection("posts")) as any[];
  return posts.map((post: any) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props as { post: any };
const { title, date, tags, coverImage } = post.data;
// ðŸ‘‡ THIS is the important bit: get Content from post.render()
const { Content } = await (post as any).render();

const formatDate = (d: any) =>
  typeof d === "string" ? d : new Date(d).toISOString().slice(0, 10);
---

<BaseLayout title={`${title} Â· Grumpy Pickleballer`}>
  <article>
    <header class="hero">
      <h1>{title}</h1>
      <p>
        <time>{formatDate(date)}</time>
        {
          tags && tags.length > 0 && (
            <>
              {" Â· "}
              {tags.join(", ")}
            </>
          )
        }
      </p>
      {
        coverImage && (
          <img
            src={coverImage}
            alt={title}
            style="max-width: 100%; border-radius: 1rem; margin-top: 1rem;"
          />
        )
      }
    </header>

    <section class="post-body">
      <Content />
    </section>
  </article>
</BaseLayout>
